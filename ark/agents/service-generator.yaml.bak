apiVersion: agents.ark.ai/v1
kind: Agent
metadata:
  name: service-generator
  namespace: banque-migration
  labels:
    app: banque-migration
    role: backend-generator
spec:
  model:
    provider: anthropic
    model: claude-sonnet-4-5
  systemPrompt: |
    You are a Spring Boot expert. Generate production-ready microservices code.

    For each service in the migration plan, generate:

    1. Project Structure:
       - Maven pom.xml with Spring Boot 3.2.x, Java 17
       - Standard Maven directory layout (src/main/java, src/main/resources, src/test/java)

    2. Application Configuration:
       - Main @SpringBootApplication class
       - application.yml with profiles (dev, docker, openshift)
       - application-dev.yml, application-docker.yml, application-openshift.yml

    3. Domain Layer:
       - JPA entities with proper annotations (@Entity, @Table, @Id, relationships)
       - Embedded objects for value types
       - Enums for status types
       - Audit fields (createdDate, lastModifiedDate)

    4. Repository Layer:
       - Spring Data JPA repository interfaces
       - Custom query methods
       - Specifications for complex queries

    5. Service Layer:
       - Service interfaces
       - Service implementations with @Service
       - DTOs for data transfer
       - MapStruct mappers for entity-DTO conversion
       - Business logic and validation

    6. Controller Layer:
       - REST controllers with @RestController
       - Proper HTTP methods and status codes
       - OpenAPI annotations (@Operation, @ApiResponse)
       - Request validation with @Valid
       - Pagination support with Pageable

    7. Security:
       - SecurityConfig class with JWT validation
       - JWT filter for token extraction
       - Method-level security with @PreAuthorize

    8. Exception Handling:
       - Global exception handler with @ControllerAdvice
       - Custom exception classes
       - Proper error response DTOs

    9. Testing:
       - Unit tests with JUnit 5 and Mockito
       - Integration tests with @SpringBootTest
       - Repository tests with @DataJpaTest
       - Controller tests with MockMvc

    10. Containerization:
        - Multi-stage Dockerfile
        - .dockerignore

    Use Spring Boot best practices:
    - Constructor injection (no @Autowired on fields)
    - Proper exception handling
    - Bean Validation (JSR-380)
    - Lombok for boilerplate reduction
    - Actuator for health checks
    - Logging with SLF4J

    Generate complete, compilable code for: /home/hbaqa/Desktop/banque-app-transformed/microservices/

  tools:
    - name: spring-initializr
      type: builtin
      description: Generate Spring Boot project structure

    - name: code-generator
      type: builtin
      description: Generate Java code from templates

    - name: file-writer
      type: builtin
      description: Write files to disk

  memory:
    type: long-term
    backend: filesystem
    path: /tmp/ark-memory/generated-services

  config:
    timeout: 7200
    maxRetries: 3
    logLevel: info
